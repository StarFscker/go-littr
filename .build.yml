image: archlinux
packages:
  - go
  - postgresql
  - sudo
sources:
  - https://github.com/mariusor/littr.go
environment:
  GO111MODULE: 'on'
tasks:
  - setup: |
      sudo -u postgres -- initdb --locale en_US.UTF-8 -E UTF8 -D /var/lib/postgres/data
      sudo systemctl start postgresql.service
      cd littr.go && go mod download
  - show_env: |
      go version
      make --version
      $(readlink -f /proc/$$/exe) --version
      pg_ctl --version
  - build: |
      cd littr.go
      cp .env.example .env
      make all
  - tests: |
      cd littr.go
      make tests
